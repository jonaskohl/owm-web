{% set title = "Source code" %}
{% set activeNav = "source" %}
{% extends "_layout.twig" %}
{% block body %}
<p style="float:right;margin:0">
    <a class="button" href="https://github.com/{{ getenv("REPO_AUTHOR")|url_encode }}/{{ getenv("REPO_NAME")|url_encode }}/archive/refs/heads/{{ getenv("REPO_BRANCH")|url_encode }}.tar.gz"><img src="img/owm_web_icon_download.png" width="11" height="11" alt="" />&nbsp;Download archive</a>
    {# <a class="button" href="#" onclick="$('#cloneUrl').slideToggle('fast', function(){$owm.resizePageHeight()});return false"><img src="img/owm_web_icon_clone.png" width="11" height="11" alt="" />&nbsp;Clone repository</a> #}
    <a class="button" href="#" onclick="$('#cloneUrl').toggle('fast', function(){$owm.resizePageHeight()});return false"><img src="img/owm_web_icon_clone.png" width="11" height="11" alt="" />&nbsp;Clone repository</a>
</p>
<h2>Source code</h2>
<div style="clear:both"></div>
<div id="cloneUrl" class="box" style="display:none">
    <div class="code-wrapper">
        <pre>{#
#}git clone https://github.com/{{ getenv("REPO_AUTHOR")|url_encode }}/{{ getenv("REPO_NAME")|url_encode }}.git
cd {{ getenv("REPO_NAME") }}
git checkout {{ getenv("REPO_BRANCH") }}{#
#}</pre>
    </div>
</div>
<h2>Commit history</h2>
<table class="full-width bordered">
    <thead>
        <tr>
            <th></th>
            <th>SHA</th>
            <th>Author</th>
            <th>Message</th>
            <th>Date</th>
        </tr>
    </thead>
    <tbody>
{% for i, commit in commits %}
        <tr class="{{ i % 2 == 0 ? "even" : "odd" }}">
            <td class="col-collapsed col-center">
                {% if commit.commit.verification.verified %}
                    <img src="img/green.png" width="23" height="22" class="verification-status" alt="Verified commit" title="Verified commit" />
                {% else %}
                    <img src="img/yellow.png" width="23" height="22" class="verification-status" alt="Unverified commit" title="Unverified commit" />
                {% endif %}
            </td>
            <td><a href="{{ commit.html_url }}"><code>{{ commit.sha|slice(0, 7) }}</code></a></td>
            <td>
                <img class="avatar-image" src="avatarproxy.php?url={{ (commit.author.avatar_url ~ "&s=16")|url_encode }}" alt="Avatar" width="16" height="16" />
                <a href="{{ commit.author.html_url }}">{{ commit.commit.author.name }}</a>
            </td>
            <td>{{ owm_truncate_string(commit.commit.message, 80) }}</td>
            <td>{{ commit.commit.committer.date|date("D, jS M Y, G:i") }}</td>
        </tr>
{% endfor %}
    </tbody>
</table>
{% endblock %}
